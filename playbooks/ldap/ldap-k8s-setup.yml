- hosts:
    - ldap
  tasks:
    - name: 环境检测
      fail:
        msg: "k8s开启高可用集群模式时不支持ldap高可用模式"
      when: '"" != KUBE_MASTER_VIP and DEPLOY_MODE == "multi-master" and (groups.ldap | length >= 2)'

- hosts:
    - ldap
  any_errors_fatal: true
  vars_files:
    - "/etc/kad/config.yml"
  roles:
    - { role: ruijie/ldap-k8s/openldap }

- name: 配置k8s内ldap双主模式{{ldap_deploy_mode}}
  when: "groups.ldap | length >= 2 "
  import_playbook: dual-k8s.yml