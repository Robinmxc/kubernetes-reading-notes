- hosts:
  - kube_node
  - kube_master
  tasks:
  - name: 删除自动执行脚本
    shell: "sed -i '/{{ ietm }}/d' /var/spool/cron/root"
    with_items:
    - "componentVersion.sh"
    - "kubectlCmd.sh"
    - "system_date.sh"

- hosts:
  - localhost
  tasks:
  - name: 获取所有已经创建的POD信息
    tags: always
    command: "{{ bin_dir }}/kubectl get pod -n monitoring"
    register: pod_info

  - name: 停止prometheus pushgateway
    command: "{{ bin_dir }}/kubectl delete -f {{ prometheus_default_dir }}/prometheus/pushgateway/"
    when: '"prometheus" in pod_info.stdout'

  - name: 停止prometheus k8score-metrics
    command: "{{ bin_dir }}/kubectl delete -f {{ prometheus_default_dir }}/prometheus/k8score-metrics/"
    when: '"prometheus" in pod_info.stdout'

  - name: 停止prometheus manifests
    command: "{{ bin_dir }}/kubectl delete -f {{ prometheus_default_dir }}/prometheus/manifests/"
    when: '"prometheus" in pod_info.stdout'

  - name: 停止prometheus manifests setup
    command: "{{ bin_dir }}/kubectl delete -f {{ prometheus_default_dir }}/prometheus/manifests/setup/"
    when: '"prometheus" in pod_info.stdout'

- hosts:
  - eoms
