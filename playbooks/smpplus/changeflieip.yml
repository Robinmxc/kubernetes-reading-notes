- hosts:
  - localhost
  ignore_errors: true
  tasks:
  - name: change files ip
    shell: 'sed -i "s/{{ old_ip }}/{{ new_ip }}/g" {{ item }}'
    with_items:
    - "/etc/init.d/autostart.sh"
    - "/etc/systemd/system/etcd.service"
    - "/etc/systemd/system/kube-apiserver.service"
    - "/etc/systemd/system/kube-controller-manager.service"
    - "/etc/systemd/system/kubelet.service"
    - "/etc/systemd/system/kube-proxy.service"
    - "/etc/systemd/system/kube-scheduler.service"
    - "/etc/etcd/ssl/etcd-csr.json"
    - "/etc/kubernetes/ssl/kubelet-csr.json"
    - "/etc/kubernetes/ssl/kubernetes-csr.json"
    - "/home/ruijie/ruijie-smpplus/frontend-smp/conf/Environment.js"
    - "/opt/kube/kube-system/flannel/kube-flannel.yaml"
    - "/opt/kad/workspace/ruijie-smpplus/yaml/mongo/mongo1.yml"
    - "/opt/kad/workspace/ruijie-smpplus/yaml/rocketmq/rocketmq.yml"
    - "/home/ruijie/ruijie-smpplus/rocketmq/conf/broker.conf"
    - "/home/ruijie/ruijie-smpplus/authentication/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/linkid/conf/application-prd.properties"
    - "/home/ruijie/ruijie-smpplus/eportal/conf/application-prd.properties"
    - "/home/ruijie/ruijie-smpplus/nodeidentify/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/linkage-devices/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/nodeconnector/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/nodeconnector/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/license/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/nodemanager-scan/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/operations/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/pcap-scan/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/sms-middleware/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/aggregation/conf/application-prd.yml"
    - "/home/ruijie/ruijie-smpplus/component/conf/application-prd.properties"
    - "/home/ruijie/ruijie-smpplus/frontend-client/conf/client_config.js"
    - "/home/ruijie/ruijie-smpplus/nodecompliance/conf/application-prd.yml"
    - "/opt/kube/kube-system/nginx-ingress/nginx.tmpl"
    - "/opt/kube/kube-system/nginx-ingress/ingress-smpplus.yaml"

  - name: 获取maintenance-related script
    tags:
      - maintenance-related
    shell: "grep 'smpplus-oper.sh'  /var/spool/cron/root | cat"
    register: maintenance_script_status

  - name: delete maintenance-related
    tags:
      - maintenance-related
    shell: "sed -i '/{{ item }}/d' /var/spool/cron/root"
    with_items:
      - "smpplus-oper.sh"
    when: '"smpplus-oper.sh"  in maintenance_script_status.stdout'

