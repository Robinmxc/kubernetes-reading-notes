# ---------基础参数--------------------

#默认二进制文件目录
bin_dir: "/opt/kube/bin"

mongodb_addr: "{% if (groups['mongodb'] | length | int) == 1 %}mongo1{% else %}mongo1,mongo2,mongo3{% endif %}"
mongodb_auth_mode: "yes"
mongo_auth_param: "{% if mongodb_auth_mode == 'yes' %}-u {{ MONGODB_ADMIN_USER }} -p {{ MONGODB_ADMIN_PWD }} --authenticationDatabase admin{% else %}{% endif %}"
mongo_shell_fail_pattern: '"ok" : 0'
mongo_shell_success_pattern: '"ok" : [1-9]+'

namespace_dir: "{{ base_dir }}/workspace/{{ APP_NAMESPACE }}"

yaml_dir: "{{ namespace_dir }}/yaml"

max_space_dir: "{{
    hostvars[groups['kube_node'][0]].ansible_mounts
    | selectattr('mount', 'match', '^(?!/var/lib/).*')
    | sort(attribute='size_available')
    | map(attribute='mount')
    | list
    | last }}"

DATA_DIR: "{% if '/' == max_space_dir %}{% else %}{{ max_space_dir }}{% endif %}"

config_base_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}"

mongodb_data_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/mongodb/data"
mongodb_init_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/mongodb/init"
mongodb_backup_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/mongodb/backup"

rocketmq_data_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/rocketmq/data"
rocketmq_logs_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/rocketmq/log"
rocketmq_conf_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/rocketmq/conf"

mgob_data_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/mgob/data"

pgsql_init_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/pgsql/init"
pgsql_data_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/pgsql/data"

db_user_pattern: "^[a-zA-Z0-9_]{3,16}$"
db_user_invalid_msg: "账号只能由大/小写字母、数字、下划线组成，长度3~16字符"

db_pwd_pattern1: "^[a-zA-Z0-9_]{6,16}$"
db_pwd_pattern2: "^.*(?=.*\\d)(?=.*[A-Z]{1,})(?=.*[a-z]{1,}).*$"
db_pwd_invalid_msg: "密码只能由大/小写字母、数字、下划线组成，至少1个大写字母，1个小写字母和1个数字，长度6~16字符"


#SourceId镜像
SOURCEID_DOCKERS: {
  linkid: {name: "sourceid/linkid", version: "dlmu.r1.3"},
  sso: {name: "sourceid/sso", version: "dlmu.r1.3"},
  gate: {name: "sourceid/gate", version: "dlmu.r1.3"},
  frontend: {name: "sourceid/frontend", version: "dlmu.r1.3"},
  component: {name: "sourceid/component", version: "dlmu.r1.3"}
}

PRIVATE_REGISTRY_ENABLED: "no"
PRIVATE_INSECURE_REGISTRY: "172.17.8.20:8082"
PRIVATE_REGISTRY_USER: ""
PRIVATE_REGISTRY_PWD: ""

#cas数据库账号和密码
SOURCEID_CAS_DB_USER: "cas"
SOURCEID_CAS_DB_PWD: ""

#gate数据库账号和密码
SOURCEID_GATE_DB_USER: "gateuser"
SOURCEID_GATE_DB_PWD: ""

#linkid数据库账号和密码
SOURCEID_LINKID_DB_USER: "linkid"
SOURCEID_LINKID_DB_PWD: ""

#component数据库账号和密码
COMPONENT_DB_USER: "comp"
COMPONENT_DB_PWD: ""

SOURCEID_FACEID_DB_USER: "faceiduser"
SOURCEID_FACEID_DB_PWD: ""

SOURCEID_GATEWAY_DB_USER: "gatewayuser"
SOURCEID_GATEWAY_DB_PWD: ""

SOURCEID_GROUPVIEW_DB_USER: "groupview"
SOURCEID_GROUPVIEW_DB_PWD: ""

SOURCEID_LOG_DB_USER: "log"
SOURCEID_LOG_DB_PWD: ""

SOURCEID_INTERNETID_DB_USER: "internetid"
SOURCEID_INTERNETID_DB_PWD: ""

SOURCEID_ZTSYNC_DB_USER: "ztsync"
SOURCEID_ZTSYNC_DB_PWD: ""

SOURCEID_MDM_DB_USER: "mdm"
SOURCEID_MDM_DB_PWD: ""

SOURCEID_CAREER_DB_USER: "career"
SOURCEID_CAREER_DB_PWD: ""

SOURCEID_REPORT_DB_USER: "report"
SOURCEID_REPORT_DB_PWD: ""

SOURCEID_READONLY_DB_USER: "readonly"
SOURCEID_READONLY_DB_PWD: "{{ MONGODB_READONLY_PWD }}"

SOURCEID_LICENSE_ENABLED: "{% if SOURCEID_DOCKERS.license is defined %}yes{% else %}no{% endif %}"

SOURCEID_HTTPS_MODE: "{% if 'https' == ingress_mode %}normal{% else %}none{% endif %}"

SOURCEID_SSO_HOST_ALIAS: "{% if 'dev' == SOURCEID_DEPLOY_PROFILE %}{{ groups['kube_node'][0] }}{% else %}{% endif %}"

SOURCEID_FRONTEND_URL: "{% if 'none' == SOURCEID_HTTPS_MODE %}http{% else %}https{% endif %}://{{ SOURCEID_GATE_DOMAIN }}"

SOURCEID_SSO_URL: "{% if 'none' == SOURCEID_HTTPS_MODE %}http{% else %}https{% endif %}://{{ SOURCEID_SSO_DOMAIN }}"

SOURCEID_MYAPP_URL: "{% if 'none' == SOURCEID_HTTPS_MODE %}http{% else %}https{% endif %}://{{ SOURCEID_MYAPP_DOMAIN }}"

SOURCEID_FGM_VERSION_ENABLED: "yes"

SOURCEDATA_USER_SYNC_TABLE_NAME: "sid_user_info"


# dns 自动安装，可选"coredns"和“kubedns”
dns_install: "yes"
dns_backend: "coredns"
kubedns_offline: "kubedns_1.14.13.tar"
coredns_offline: "coredns-1.6.9.tar"
dns_offline: "{%- if dns_backend == 'coredns' -%} \
                {{ coredns_offline }} \
              {%- else -%} \
                {{ kubedns_offline }} \
              {%- endif -%}"

dns_replicas: "{% if DEPLOY_MODE == 'allinone' %}1{% else %}2{% endif %}"

# 集群 DNS 域名
CLUSTER_DNS_DOMAIN: "cluster.local."

MGOB_ENABLED: "no"

#证书目录
ca_dir: "/etc/kubernetes/ssl"

ingress_ca_dir: "/etc/kad/ssl"

kubernetes_version: "v1.18.8"


#调用链监控相关配置
SKYWALKING: {
  #只有enable设置为true时，才会部署
  enable: false,
  #服务端地址
  SERVER_HOST: "172.17.9.98",
  #agent版本
  IMAGE_VERSION: "1.0-20211029",
  #namespace
  NAMESPACE: "SourceID",

  AGENT_PREFIX: "SourceID",

  JAVA_AGENT_EXT: "-javaagent:/skywalking/agent/skywalking-agent.jar",
}

# 健康检查相关配置，默认部分组件关闭
HEALTH_CHECK: {
  
  enable: true,
  internetid: false,
  faceid: false,
  groupview: false

}

MGOB: {
# MGOB_ENABLED：yes - 部署mongodb备份组件； no - 不部署；默认不部署
  MGOB_ENABLED: true,

  #备份数据库名称，""表示备份所有
  MGOB_DATABASE: "admin",
  #备份操作执行时间
  MGOB_CRON: "0 2 */1 * *",
# MGOB_SFTP_RETENTION：备份文件保存个数，结合数据库实际大小和磁盘空间合理配置
  MGOB_SFTP_RETENTION: "3",

# MGOB_SFTP_ENABLED: yes - mongodb上传sftp服务器； no - 不上传；默认不上传,不配置时，备份的数据库文件只会保留在本地，存在丢失风险
  MGOB_SFTP_ENABLED: "no",

# MGOB_SFTP_HOSTS、MGOB_SFTP_PORT、MGOB_SFTP_USER、MGOB_SFTP_PWD：SFTP服务器地址、端口、用户名、密码
  MGOB_SFTP_HOSTS: "172.17.8.128",
  MGOB_SFTP_PORT: "22",
  MGOB_SFTP_USER: "root",
  MGOB_SFTP_PWD: "shyfzx@163",
  MGOB_SFTP_DIR: "/home/mongodbBackUP"
}

#自定义路径，前后不要加‘/’
CUSTOMIZE_SUFFIX: ""

# @todo sourceid域名模式 single-单域名，multiple-多域名，自动判断sso、gate、adapter域名是否相等
SOURCEID_DOMAIN_MODE: "{% if SOURCEID_SSO_DOMAIN == SOURCEID_GATE_DOMAIN and SOURCEID_SSO_DOMAIN == SOURCEID_ADAPTER_DOMAIN %}single{% else %}multiple{% endif %}"