# ---------基础参数--------------------

#默认二进制文件目录
bin_dir: "/opt/kube/bin"

mongodb_addr: "{% if (groups['mongodb'] | length | int) == 1 %}mongo1{% else %}mongo1,mongo2,mongo3{% endif %}"
mongodb_auth_mode: "yes"
mongo_auth_param: "{% if mongodb_auth_mode == 'yes' %}-u {{ MONGODB_ADMIN_USER }} -p {{ MONGODB_ADMIN_PWD }} --authenticationDatabase admin{% else %}{% endif %}"
mongo_shell: "{{ bin_dir }}/kubectl exec -n {{ APP_NAMESPACE }} mongo1 -- mongo {{ mongo_auth_param }}"
mongo_shell_fail_pattern: '"ok" : 0'
mongo_shell_success_pattern: '"ok" : [1-9]+'

namespace_dir: "{{ base_dir }}/workspace/{{ APP_NAMESPACE }}"

yaml_dir: "{{ namespace_dir }}/yaml"

max_space_dir: "{{
    hostvars[groups['kube_node'][0]].ansible_mounts
    | selectattr('mount', 'match', '^(?!/var/lib/).*')
    | sort('size_available' | int)
    | map(attribute='mount')
    | list
    | last }}"

DATA_DIR: "{% if '/' == max_space_dir %}{% else %}{{ max_space_dir }}{% endif %}"

config_base_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}"

mongodb_data_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/mongodb/data"
mongodb_init_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/mongodb/init"

rocketmq_data_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/rocketmq/data"
rocketmq_logs_dir: "{{ DATA_DIR }}/ruijie/{{ APP_NAMESPACE }}/rocketmq/log"

db_user_pattern: "^[a-zA-Z0-9_]{3,16}$"
db_user_invalid_msg: "账号只能由大/小写字母、数字、下划线组成，长度3~16字符"

db_pwd_pattern1: "^[a-zA-Z0-9_]{6,16}$"
db_pwd_pattern2: "^.*(?=.*\\d)(?=.*[A-Z]{1,})(?=.*[a-z]{1,}).*$"
db_pwd_invalid_msg: "密码只能由大/小写字母、数字、下划线组成，至少1个大写字母，1个小写字母和1个数字，长度6~16字符"


#SourceId数据库脚本版本号
SOURCEID_DB_VERSION: "R1.3"

#component数据库脚本版本号
COMPONENT_DB_VERSION: "v1.0"

#SourceId镜像
SOURCEID_DOCKERS: {
  linkid: {name: "sourceid/linkid", version: "dlmu.r1.3"},
  sso: {name: "sourceid/sso", version: "dlmu.r1.3"},
  gate: {name: "sourceid/gate", version: "dlmu.r1.3"},
  frontend: {name: "sourceid/frontend", version: "dlmu.r1.3"},
  component: {name: "sourceid/component", version: "dlmu.r1.3"}
}

PRIVATE_REGISTRY_ENABLED: "no"
PRIVATE_INSECURE_REGISTRY: "id.ruijie.com.cn:25082"
PRIVATE_REGISTRY_USER: ""
PRIVATE_REGISTRY_PWD: ""

#cas数据库账号和密码
SOURCEID_CAS_DB_USER: "cas"
SOURCEID_CAS_DB_PWD: ""

#gate数据库账号和密码
SOURCEID_GATE_DB_USER: "gateuser"
SOURCEID_GATE_DB_PWD: ""

#linkid数据库账号和密码
SOURCEID_LINKID_DB_USER: "linkid"
SOURCEID_LINKID_DB_PWD: ""

#component数据库账号和密码
COMPONENT_DB_USER: "comp"
COMPONENT_DB_PWD: ""

SOURCEID_FACEID_DB_USER: "faceiduser"
SOURCEID_FACEID_DB_PWD: ""

SOURCEID_GATEWAY_DB_USER: "gatewayuser"
SOURCEID_GATEWAY_DB_PWD: ""

SOURCEID_LICENSE_ENABLED: "{% if SOURCEID_DOCKERS.license is defined %}yes{% else %}no{% endif %}"

SOURCEID_HTTPS_MODE: "{% if 'https' == traefik_mode %}normal{% else %}none{% endif %}"

SOURCEID_SSO_HOST_ALIAS: "{% if 'dev' == SOURCEID_DEPLOY_PROFILE %}{{ groups['kube_node'][0] }}{% else %}{% endif %}"

SOURCEID_FRONTEND_URL: "{% if 'none' == SOURCEID_HTTPS_MODE %}http{% else %}https{% endif %}://{{ SOURCEID_GATE_DOMAIN }}"

SOURCEID_SSO_URL: "{% if 'none' == SOURCEID_HTTPS_MODE %}http{% else %}https{% endif %}://{{ SOURCEID_SSO_DOMAIN }}"

SOURCEID_FACEID_ENABLED: "no"

# 二次认证网关部署模式：none - 不部署；k8s - 部署在K8S集群里面；standalone - 单独部署
SOURCEID_GATEWAY_DEPLOY_MODE: "none"

# 二次认证网关单独部署时的服务器IP地址
SOURCEID_GATEWAY_HOSTS: []

# 二次认证网关双机模式时的虚IP
SOURCEID_GATEWAY_VIP: ""
