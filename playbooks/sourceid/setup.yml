- hosts:
  - kube_node
  tags: always
  any_errors_fatal: true
  roles:
  - ruijie/sourceid/env

- hosts:
  - mongodb
  tags:
  - mongodb
  - midware
  any_errors_fatal: true
  roles:
  - { role: ruijie/mongo}

- hosts:
  - rocketmq
  tags:
  - rocketmq
  - midware
  any_errors_fatal: true
  roles:
  - { role: ruijie/rocketmq}

- hosts:
  - kube_node
  tags:
  - initdata
  any_errors_fatal: true
  vars_files:
  - "{{ KAD_PACKAGE_DIR }}/kad.yml"
  roles:
  - { role: ruijie/sourceid/prepare-db-pwd, tags: always }
  - { role: ruijie/sourceid/dbinit }

- hosts:
  - kube_node
  tags:
  - sourceid
  any_errors_fatal: true
  vars_files:
  - "{{ KAD_PACKAGE_DIR }}/kad.yml"
  roles:
  - { role: ruijie/sourceid/prepare-db-pwd, tags: always }
  - { role: ruijie/sourceid/linkid, tags: ["linkid"]}
  - { role: ruijie/sourceid/sso, tags: ["sso"] }
  - { role: ruijie/sourceid/gate, tags: ["gate"] }
  - { role: ruijie/sourceid/component, tags: ["component"] }
  - { role: ruijie/sourceid/frontend, tags: ["frontend"] }
  - { role: ruijie/sourceid/license, tags: ["license"] }
  - { role: ruijie/sourceid/faceid, tags: ["faceid"] }
  - { role: ruijie/sourceid/faceid-display, tags: ["faceid-display"] }
  - { role: ruijie/sourceid/gateway/common, tags: ["gateway"] }
  - { role: ruijie/sourceid/gateway/k8s, tags: ["gateway"] }
  - { role: ruijie/sourceid/import-user, tags: ["import-user"] }
  - { role: ruijie/sourceid/data-sync, tags: ["data-sync"] }

- hosts:
  - gateway
  tags:
  - sourceid
  any_errors_fatal: true
  vars_files:
  - "{{ KAD_PACKAGE_DIR }}/kad.yml"
  roles:
  - ruijie/cluster/docker
  - { role: ruijie/sourceid/prepare-db-pwd, tags: always }
  - { role: ruijie/sourceid/gateway/common, tags: ["gateway"] }
  - { role: ruijie/sourceid/gateway/standalone/setup, tags: ["gateway"] }
