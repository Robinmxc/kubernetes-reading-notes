- hosts:
  - localhost
  tasks:
  - name: 创建/etc/kad目录
    file: path="/etc/kad/" state=directory

  - name: 创建/etc/kad/config.yml文件
    file: path="/etc/kad/config.yml" state=touch





- hosts: 
  - localhost
  tasks:
  - name: 获取Kubernetes版本
    shell: "{{ bin_dir }}/kube-apiserver --version"
    register: k8s_ver

  - block:

    when: "'v1.18.8' not in k8s_ver.stdout"


- hosts: all
  tags:
  - sourceid
  any_errors_fatal: true
  vars_files:
  - "{{ KAD_PACKAGE_DIR }}/kad.yml"
  - "/etc/kad/config.yml"
  roles:
  - { role: ruijie/sourceid/prepare-db-pwd, tags: always }
  - { role: ruijie/sourceid/upgrade, tags: always }


# to install clust-addons
- hosts:
  - kube_node
  any_errors_fatal: true
  roles:
  - ruijie/cluster/kube-dns