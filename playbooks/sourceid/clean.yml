- hosts:
  - localhost
  gather_facts: false
  tasks:
  - name: 获取所有已经创建的POD信息
    command: "{{ bin_dir }}/kubectl get pod -n {{ APP_NAMESPACE }}"
    register: pod_info

  - name: delete depoyments
    vars:
      workspace_dir: "{{ base_dir }}/workspace/{{ APP_NAMESPACE }}"
      yaml_dir: "{{ workspace_dir }}/yaml"
    command: "{{ bin_dir }}/kubectl delete -f {{ yaml_dir }}/{{ item }}/"
    when: 'item in pod_info.stdout'
    ignore_errors: true
    with_items:
    - "frontend"
    - "gate"
    - "component"
    - "sso"
    - "linkid"
