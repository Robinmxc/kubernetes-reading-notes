- name: 获取{{ check_dir }}目录的容量
  vars:
    pattern: "^{{ item.mount }}.*$"
  set_fact: check_dir_mount_info='{{ item }}'
  when: 'check_dir is search(pattern)'
  with_items: '{{ hostvars[inventory_hostname].ansible_mounts | sort(attribute="mount") | list }}'

- name: 检查存储{{ check_dir }}目录容量是否足够
  fail: msg="目录{{ check_dir }}剩余空间不足{{ space_required }}G"
  when: '(check_dir_mount_info.size_available | int) < (space_required | int) * 1073741824'
