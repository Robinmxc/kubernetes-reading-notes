- name: 获取部署状态
  set_fact:
    deploy_state: '{% if "/opt/kube/bin/kube-apiserver" is exists %}1{% else %}0{% endif %}'
  connection: local
  run_once: true

- name: 检查系统盘空间
  vars:
    check_dir: "/opt"
    space_required: '{% if "0" == deploy_state %}{{ sys_disk_required }}{% else %}95{% endif %}'
  import_tasks: "../../../utils/tasks/check_disk_space.yml"

- name: 检查数据盘空间
  vars:
    check_dir: '{% if "" == DATA_DIR %}/{% else %}{{ DATA_DIR }}{% endif %}'
    space_required: '{{ disk_required[CLUSTER_SCALE][K8S_ROLE] }}'
  import_tasks: "../../../utils/tasks/check_disk_space.yml"
