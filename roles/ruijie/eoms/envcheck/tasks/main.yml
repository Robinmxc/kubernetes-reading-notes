- name: 检查运维平台配置参数
  fail: msg="安装运维平台需要先设置EOMS参数"
  when: 'EOMS_ENABLE == "no"'

- name: 更新加载所需基础rpm包
  when: 'EOMS_ENABLE == "yes"'
  block:
    - name: 准备目录
      file: name={{ item }} state=directory
      with_items:
        - "{{ DEST_FILE_PATH }}/rpm"

    - name: 复制安装文件
      copy:
        src: "{{ EOMS_DOWN_PATH }}/rpm/"
        dest: "{{ DEST_FILE_PATH }}/rpm/"

    - name: 安装基础依赖文件
      vars:
        rpm_file_name: "fontconfig"
      shell: "rpm -Uvh --force --nodeps {{ DEST_FILE_PATH }}/rpm/*.rpm "
      when: 'rpm_file_name in rpm_copy_info.stdout'
      ignore_errors: true



 
