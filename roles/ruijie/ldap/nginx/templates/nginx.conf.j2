worker_processes  1;
events {
    worker_connections  1024;
}

# 配置tcp
stream {
    upstream slapd {
        hash $remote_addr consistent;
        server {{ ldap_1_hostname }}:{{ port }} max_fails=3 fail_timeout=30s;
        server {{ ldap_2_hostname }}:{{ port }} max_fails=3 fail_timeout=30s;
    }
    server {
        listen 389;
        proxy_connect_timeout 6s;
        proxy_timeout 30s;
        proxy_pass slapd;
    }
}
