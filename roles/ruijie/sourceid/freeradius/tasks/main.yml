- name: 部署freeradius
  when: 'FREERADIUS_ENABLE == "yes"'
  block:
  - name: 准备部署文件目录
    tags:
      - config
    file: path={{ item }} state=directory
    with_items:
      - "{{ yaml_dir }}/freeradius"
    run_once: true
    connection: local

  - name: 准备部署文件
    tags:
      - config
    vars:
      deploy_conf: '{{ freeradius_deploy_conf }}'
      comp_name: 'freeradius'
      deploy_node_ip: "{{ groups.ess[0] }}"
    template: src='freeradius.yaml.j2' dest={{ yaml_dir }}/freeradius/freeradius.yml
    run_once: true
    connection: local

  - name: 获取所有已经创建的POD信息
    tags:
      - deploy
    command: "kubectl get pod -n {{ APP_NAMESPACE }}"
    register: pod_info
    run_once: true
    connection: local

  - name: 执行部署
    tags:
      - deploy
    shell: "kubectl apply -f {{ yaml_dir }}/freeradius/"
    run_once: true
    connection: local

