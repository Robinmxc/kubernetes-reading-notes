upstream sid {
   {% for host in KUBE_NEW_NODE_HOSTS %}
    server {{ host }}:80 max_fails=3 fail_timeout=60s;
   {% endfor %}

}


server {
    listen 80;
  {% if SOURCEID_SSO_DOMAIN == SOURCEID_GATE_DOMAIN and SOURCEID_SSO_DOMAIN == SOURCEID_ADAPTER_DOMAIN %}
   server_name {{ SOURCEID_SSO_DOMAIN }} {{ SOURCEID_MYAPP_DOMAIN }};
  {% else %}
   server_name {{ SOURCEID_SSO_DOMAIN }} {{ SOURCEID_GATE_DOMAIN }} {{ SOURCEID_ADAPTER_DOMAIN }} {{ SOURCEID_MYAPP_DOMAIN }};
  {% endif %}
   access_log /usr/local/openresty/nginx/logs/{{ SOURCEID_SSO_DOMAIN }}_access.log main;
   error_log /usr/local/openresty/nginx/logs/{{ SOURCEID_SSO_DOMAIN }}_error.log;

    location / {
        proxy_pass  http://sid;
        proxy_redirect off;
        proxy_set_header   X-Real-IP        $remote_addr;
        proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto    $scheme;
        proxy_set_header   Host             $host;
    }    
}



