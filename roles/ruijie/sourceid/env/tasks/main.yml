- name: 确保unzip已安装
  yum:
    name:
      - unzip
    state: present

- name: 准备目录
  file: path={{ item }} state=directory
  with_items:
  - "{{ temp_dir }}"
  - "{{ yaml_dir }}"
  - "{{ namespace_dir }}/conf"

- name: 读取目录信息
  stat: path="{{ KAD_PACKAGE_DIR }}"
  register: p

- name: 创建解压目录
  file: path="{{ KAD_PACKAGE_DIR }}" state=directory
  when: 'not p.stat.exists'

- name: 解压SourceID安装包
  vars:
    zip_file: "{{ base_dir }}/down/{{ KAD_PACKAGE_NAME }}.zip"
  unarchive:
    src: "{{ zip_file }}"
    dest: "{{ KAD_PACKAGE_DIR }}"
  when: 'not p.stat.exists and zip_file is exists'

- name: 拷贝SourceID配置文件
  vars:
    src_path: "{{ KAD_PACKAGE_DIR }}/conf/{{ item }}"
    dest_path: "{{ namespace_dir }}/conf/{{ item }}"
  copy: src="{{ src_path }}/" dest="{{ dest_path }}/"
  when: 'dest_path is not exists'
  with_items:
    - "sourceid/sso"
    - "sourceid/gate"
    - "sourceid/linkid"
    - "sourceid/frontend"
    - "component"
